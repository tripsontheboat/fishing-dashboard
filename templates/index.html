{% extends "base.html" %}
{% block content %}

<h1>Dashboard</h1>

<!-- Summary Cards -->
<div class="stats-container">
    <div class="stat-card">
        <h2>{{ total_trips }}</h2>
        <p>Total Trips</p>
    </div>

    <div class="stat-card">
        <h2>{{ total_fish }}</h2>
        <p>Total Fish Counted</p>
    </div>

    <div class="stat-card">
        <h2>{{ most_common_species if most_common_species else "N/A" }}</h2>
        <p>Most Common Species</p>
    </div>
</div>

<!-- Filter Box -->
<div class="filter-box">
    <form method="get">
        <label>Start Date:</label>
        <input type="date" name="start" value="{{ request.args.get('start', '') }}">

        <label>End Date:</label>
        <input type="date" name="end" value="{{ request.args.get('end', '') }}">

        <label>Species:</label>
        <select name="species">
            <option value="all">All</option>
            {% for s in species_list %}
                <option value="{{ s.species }}" {% if request.args.get('species') == s.species %}selected{% endif %}>
                    {{ s.species }}
                </option>
            {% endfor %}
        </select>

        <label>Sort:</label>
        <select name="sort">
            <option value="newest">Newest First</option>
            <option value="oldest" {% if request.args.get('sort') == 'oldest' %}selected{% endif %}>Oldest First</option>
        </select>

        <button type="submit" class="save-btn">Apply</button>
    </form>
</div>

<!-- Data Table -->
<table>
    <tr>
        <th>Date</th>
        <th>Location</th>
        <th>Species</th>
        <th>Count</th>
        <th>Bait</th>
        <th>Size</th>
        <th>Water</th>
        <th>Platform</th>
        <th>Water Temp</th>
        <th>Wind</th>
        <th>Wave Height</th>
        <th>Image</th>
        <th>Actions</th>
    </tr>

    {% for row in data %}
    <tr>
        <td>{{ row.date }}</td>
        <td>{{ row.location }}</td>
        <td>{{ row.species }}</td>
        <td>{{ row.count }}</td>
        <td>{{ row.bait }}</td>
        <td>{{ row.size }}</td>
        <td>{{ row.water }}</td>
        <td>{{ row.platform }}</td>
        <td>{{ row.water_temp }}</td>
        <td>{{ row.wind }}</td>
        <td>{{ row.wave_height }}</td>

        <td>
            {% if row.image %}
                <img src="{{ url_for('static', filename='uploads/' ~ row.image) }}" 
                     style="width:60px; border-radius:4px;">
            {% endif %}
        </td>

        <td>
            {% if current_user.role in ["write", "admin"] %}
                <a href="/edit/{{ row.id }}">Edit</a> |
                <a href="/delete/{{ row.id }}">Delete</a>
            {% else %}
                View Only
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}

